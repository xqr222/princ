'''
Script to insert pre-generated freight request data into the database.
'''
import sqlite3
import traceback

DATABASE_NAME = 'pricing_data.db'

# Data generated from the previous step (ALL 80 requests)
GENERATED_DATA = [
    ('2025-05-11 11:24:40', 1, '鲜活', 135.38, 864442.9),
    ('2025-05-13 15:25:39', 1, '鲜活', 49.86, 294273.75),
    ('2025-05-11 03:50:53', 1, '鲜活', 193.21, 1295813.16),
    ('2025-05-14 22:20:57', 1, '快件', 29.81, 248398.73),
    ('2025-05-17 11:33:53', 1, '鲜活', 139.46, 659863.12),
    ('2025-05-13 15:08:30', 1, '鲜活', 184.96, 834020.31),
    ('2025-05-15 09:44:59', 1, '鲜活', 173.01, 786454.5),
    ('2025-05-18 11:54:33', 1, '普货', 675.95, 2307432.97),
    ('2025-05-13 19:39:07', 1, '快件', 15.69, 141082.64),
    ('2025-05-13 17:55:00', 1, '普货', 315.62, 2356666.36),
    ('2025-05-14 22:55:01', 1, '普货', 435.99, 1483233.28),
    ('2025-05-17 09:11:31', 1, '鲜活', 20.0, 126858.37),
    ('2025-05-14 01:20:01', 1, '快件', 32.26, 189735.28),
    ('2025-05-16 15:59:02', 1, '快件', 43.79, 390072.07),
    ('2025-05-13 07:10:08', 1, '普货', 660.17, 2630920.08),
    ('2025-05-11 08:44:45', 1, '鲜活', 117.4, 593432.77),
    ('2025-05-12 18:12:16', 1, '普货', 217.29, 1212033.59),
    ('2025-05-16 09:48:42', 1, '鲜活', 57.03, 261683.4),
    ('2025-05-10 16:46:23', 1, '普货', 617.95, 2880124.61),
    ('2025-05-17 14:48:50', 1, '鲜活', 43.65, 280436.32),
    ('2025-05-17 19:40:12', 2, '普货', 375.79, 2952612.02),
    ('2025-05-13 09:25:07', 2, '鲜活', 144.03, 916151.33),
    ('2025-05-14 04:56:19', 2, '鲜活', 30.51, 134033.3),
    ('2025-05-16 12:21:13', 2, '普货', 565.74, 2828641.02),
    ('2025-05-16 12:40:38', 2, '普货', 975.42, 5097891.83),
    ('2025-05-13 19:13:25', 2, '普货', 57.09, 382580.09),
    ('2025-05-18 00:10:19', 2, '鲜活', 117.1, 651255.47),
    ('2025-05-13 19:00:45', 2, '快件', 8.2, 59355.07),
    ('2025-05-14 04:41:43', 2, '普货', 158.88, 1241774.4),
    ('2025-05-11 06:12:01', 2, '快件', 6.11, 48732.81),
    ('2025-05-16 23:59:36', 2, '鲜活', 112.36, 763572.82),
    ('2025-05-12 03:55:07', 2, '普货', 390.48, 2808304.7),
    ('2025-05-11 12:17:42', 2, '鲜活', 65.64, 407699.79),
    ('2025-05-14 10:35:05', 2, '鲜活', 191.88, 873323.3),
    ('2025-05-17 19:20:18', 2, '鲜活', 103.42, 547940.61),
    ('2025-05-16 12:59:33', 2, '鲜活', 196.21, 1028344.71),
    ('2025-05-16 16:19:19', 2, '普货', 754.67, 4943109.42),
    ('2025-05-16 03:42:05', 2, '快件', 31.75, 243177.98),
    ('2025-05-15 05:40:06', 2, '鲜活', 40.72, 169189.8),
    ('2025-05-14 03:27:55', 2, '鲜活', 36.0, 209354.77),
    ('2025-05-10 18:52:26', 3, '普货', 604.63, 2602736.42),
    ('2025-05-15 14:56:17', 3, '普货', 795.65, 5085480.21),
    ('2025-05-15 12:39:56', 3, '普货', 602.92, 2475431.16),
    ('2025-05-11 19:09:15', 3, '普货', 264.77, 1986345.59),
    ('2025-05-12 20:44:34', 3, '普货', 964.42, 7265796.16),
    ('2025-05-16 05:03:17', 3, '普货', 118.23, 692246.31),
    ('2025-05-14 16:38:01', 3, '鲜活', 97.29, 548477.2),
    ('2025-05-13 03:20:45', 3, '普货', 82.18, 450440.05),
    ('2025-05-18 01:40:37', 3, '鲜活', 163.94, 924107.96),
    ('2025-05-14 21:36:00', 3, '快件', 40.83, 363207.63),
    ('2025-05-14 20:17:55', 3, '鲜活', 32.91, 155877.04),
    ('2025-05-16 10:11:57', 3, '鲜活', 130.15, 599364.37),
    ('2025-05-13 06:46:30', 3, '普货', 393.23, 2807875.66),
    ('2025-05-11 21:35:13', 3, '快件', 16.77, 121390.98),
    ('2025-05-15 07:53:10', 3, '普货', 483.52, 2339836.4),
    ('2025-05-17 02:25:02', 3, '快件', 17.63, 139920.99),
    ('2025-05-13 15:50:45', 3, '鲜活', 128.89, 584755.26),
    ('2025-05-15 23:59:35', 3, '鲜活', 145.49, 728380.13),
    ('2025-05-16 00:41:31', 3, '普货', 275.33, 1219273.62),
    ('2025-05-12 05:19:03', 3, '普货', 858.11, 6230327.66),
    ('2025-05-17 08:58:04', 4, '鲜活', 189.73, 1196315.64),
    ('2025-05-17 16:08:16', 4, '普货', 593.58, 4205742.42),
    ('2025-05-13 17:04:39', 4, '快件', 39.98, 209944.01),
    ('2025-05-17 07:16:00', 4, '鲜活', 48.4, 248897.25),
    ('2025-05-14 17:46:53', 4, '普货', 629.27, 4533961.21),
    ('2025-05-12 22:00:10', 4, '普货', 916.01, 4537939.79),
    ('2025-05-11 01:39:51', 4, '鲜活', 180.96, 739376.96),
    ('2025-05-12 09:58:11', 4, '快件', 48.74, 309282.86),
    ('2025-05-15 10:03:46', 4, '鲜活', 80.77, 414748.43),
    ('2025-05-15 01:50:21', 4, '普货', 549.59, 2060962.5),
    ('2025-05-16 05:39:51', 4, '普货', 66.89, 348115.35),
    ('2025-05-11 22:12:31', 4, '快件', 19.32, 145048.27),
    ('2025-05-12 11:58:21', 4, '普货', 940.97, 3015065.97),
    ('2025-05-11 03:04:32', 4, '普货', 785.31, 4622401.93),
    ('2025-05-16 09:21:37', 4, '普货', 79.24, 549838.01),
    ('2025-05-17 04:00:10', 4, '普货', 206.43, 834338.13),
    ('2025-05-17 16:28:04', 4, '普货', 700.78, 4004073.9),
    ('2025-05-13 03:03:20', 4, '快件', 26.81, 182684.27),
    ('2025-05-13 07:33:05', 4, '快件', 3.28, 28378.59),
    ('2025-05-11 06:45:25', 4, '普货', 673.03, 3599415.79)
]

def create_and_clear_table(cursor):
    cursor.execute('''
    CREATE TABLE IF NOT EXISTS freight_requests (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        request_timestamp TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP,
        route_id INTEGER NOT NULL,
        cargo_type TEXT NOT NULL,
        weight_kg REAL NOT NULL,
        volume_cm3 REAL NOT NULL,
        FOREIGN KEY (route_id) REFERENCES routes (id)
    );
    ''')
    print("INFO: `freight_requests` table checked/created.")
    cursor.execute("DELETE FROM freight_requests;")
    print("INFO: Cleared existing data from `freight_requests`.")

def insert_data():
    conn = None
    print("INFO: Starting data insertion...")
    try:
        conn = sqlite3.connect(DATABASE_NAME)
        cursor = conn.cursor()
        print("INFO: Database connected.")

        create_and_clear_table(cursor)

        inserted_count = 0
        print(f"INFO: Attempting to insert {len(GENERATED_DATA)} pre-generated requests...")
        for req_data_tuple in GENERATED_DATA:
            try:
                cursor.execute('''
                INSERT INTO freight_requests 
                    (request_timestamp, route_id, cargo_type, weight_kg, volume_cm3)
                VALUES (?, ?, ?, ?, ?);
                ''', req_data_tuple)
                inserted_count += 1
            except sqlite3.Error as item_error:
                print(f"ERROR: Could not insert item {req_data_tuple}: {item_error}")
        
        conn.commit()
        print(f"SUCCESS: Committed {inserted_count}/{len(GENERATED_DATA)} requests to the database.")

    except sqlite3.Error as e:
        print(f"ERROR: SQLite Database error during setup or commit: {e}")
        print(traceback.format_exc())
        if conn:
            conn.rollback()
    except Exception as e:
        print(f"ERROR: An unexpected error occurred: {e}")
        print(traceback.format_exc())
        if conn:
            conn.rollback()
    finally:
        if conn:
            conn.close()
            print("INFO: Database connection closed.")
        print("INFO: Data insertion script finished.")

if __name__ == '__main__':
    insert_data() 